@model RCBACONFERENCE.Models.SubmitEthicsCertificateViewModel

@{
    ViewData["Title"] = "Submit Ethics Certificate";
    Layout = "_LayoutResearcher";
}

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>

<body style="font-family: 'Montserrat', sans-serif; overflow-y: auto;">
    <div id="billboard" class="position-relative d-flex align-items-center py-1">
        <div class="container">
            <h2 class="text-center fw-bold mb-4" style="padding-top: 20px; color: #850000;">Submit Ethics Certificate</h2>

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger text-center">
                @TempData["ErrorMessage"]
            </div>
        }

        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success text-center">
                @TempData["SuccessMessage"]
            </div>
        }

        <form asp-action="SubmitEthicsCertificate" method="post" enctype="multipart/form-data" class="shadow-lg p-4 rounded bg-white mb-5">
            <!-- Select Research Event -->
            <div class="mb-3">
                <label for="ResearchEventId" class="form-label fw-bold">Select Research Event</label>
                <select asp-for="ResearchEventId" class="form-select" required>
                    <option value="">-- Select an Event --</option>
                    @foreach (var eventItem in Model.ResearchEvents)
                    {
                        <option value="@eventItem.ResearchEventId">@eventItem.DisplayText</option>
                    }
                </select>
                <span asp-validation-for="ResearchEventId" class="text-danger"></span>
            </div>

            <!-- Research Title -->
            <div class="mb-3">
                <label for="ResearchTitle" class="form-label fw-bold">Research Title</label>
                <input type="text" asp-for="ResearchTitle" class="form-control" placeholder="Enter your research title" required />
                <span asp-validation-for="ResearchTitle" class="text-danger"></span>
            </div>

            <!-- Author -->
            <div class="mb-3">
                <label for="Author" class="form-label fw-bold">Author</label>
                <input type="text" asp-for="Author" class="form-control" readonly />
            </div>

            <!-- Add Co-Authors -->
            <div class="mb-3">
                <label for="Authors" class="form-label fw-bold">Add Co-Authors</label>
                <div id="authors-container" class="d-flex flex-wrap gap-2">
                    <!-- Dynamically added co-authors will appear here -->
                </div>
                <input type="text" id="AuthorsInput" class="form-control mt-2" placeholder="Type a name and press Enter" />
                <input type="hidden" asp-for="Authors" />
            </div>

            <!-- Upload Ethics Certificate -->
            <div class="mb-3">
                <label for="EthicsCertificate" class="form-label fw-bold">Upload Ethics Certificate (PDF only)</label>
                <input type="file" asp-for="EthicsCertificate" class="form-control" accept=".pdf" required />
                <span asp-validation-for="EthicsCertificate" class="text-danger"></span>
            </div>

            <!-- Submit Button -->
            <div class="d-flex justify-content-center align-items-center">
                <button type="submit" class="btn btn-primary w-30 fw-bold">
                    <i class="bi bi-upload"></i> Submit
                </button>
            </div>
        </form>
    </div>
</div>
</body>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const authorsContainer = document.getElementById('authors-container');
            const authorsInput = document.getElementById('AuthorsInput');
            const hiddenAuthorsInput = document.querySelector('input[name="Authors"]');

            let authors = [];

            function addAuthor(name) {
                if (name && !authors.includes(name)) {
                    authors.push(name);

                    const authorTag = document.createElement('div');
                    authorTag.className = 'badge bg-primary text-light p-2 d-flex align-items-center';
                    authorTag.style.cursor = 'pointer';
                    authorTag.innerHTML = `${name} <span class="ms-2 text-white" style="cursor: pointer;">&times;</span>`;

                    authorTag.querySelector('span').addEventListener('click', function () {
                        removeAuthor(name);
                    });

                    authorsContainer.appendChild(authorTag);
                    updateHiddenAuthorsInput();
                }
            }

            function removeAuthor(name) {
                authors = authors.filter(a => a !== name);
                const tags = Array.from(authorsContainer.children);
                const tagToRemove = tags.find(tag => tag.textContent.trim().startsWith(name));
                if (tagToRemove) {
                    authorsContainer.removeChild(tagToRemove);
                }
                updateHiddenAuthorsInput();
            }

            function updateHiddenAuthorsInput() {
                hiddenAuthorsInput.value = authors.join(',');
            }

            authorsInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    const name = authorsInput.value.trim();
                    if (name) {
                        addAuthor(name);
                        authorsInput.value = '';
                    }
                }
            });
        });
    </script>
}
